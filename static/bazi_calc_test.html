<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字计算测试工具</title>
    <style>
        body {
            font-family: Arial, 'Microsoft YaHei', sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }
        button {
            background-color: #1989fa;
            color: white;
            border: none;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }
        button:hover {
            background-color: #0e73c5;
        }
        .loading {
            display: none;
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f8f8;
            border-radius: 5px;
        }
        .result {
            display: none;
            margin-top: 30px;
            padding: 20px;
            background-color: #f0f8ff;
            border-radius: 5px;
            border: 1px solid #d0e3ff;
        }
        .result h2 {
            color: #1989fa;
            margin-top: 0;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .bazi-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            margin-bottom: 20px;
        }
        .bazi-table th, .bazi-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }
        .bazi-table th {
            background-color: #f2f2f2;
        }
        pre {
            background-color: #f8f8f8;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>八字计算测试工具</h1>
        
        <div class="form-group">
            <label for="gender">性别</label>
            <select id="gender">
                <option value="男">男</option>
                <option value="女">女</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="solarYear">出生年(阳历)</label>
            <input type="number" id="solarYear" placeholder="如:1986" min="1900" max="2100" value="1986">
        </div>
        
        <div class="form-group">
            <label for="solarMonth">出生月(阳历)</label>
            <input type="number" id="solarMonth" placeholder="如:4" min="1" max="12" value="4">
        </div>
        
        <div class="form-group">
            <label for="solarDay">出生日(阳历)</label>
            <input type="number" id="solarDay" placeholder="如:23" min="1" max="31" value="23">
        </div>
        
        <div class="form-group">
            <label for="solarHour">出生时辰(24小时制)</label>
            <input type="number" id="solarHour" placeholder="如:17" min="0" max="23" value="17">
        </div>
        
        <div class="form-group">
            <label for="birthPlace">出生地</label>
            <input type="text" id="birthPlace" placeholder="如:北京市海淀区" value="北京市海淀区">
        </div>
        
        <div class="form-group">
            <label for="livingPlace">居住地</label>
            <input type="text" id="livingPlace" placeholder="如:上海市浦东新区" value="上海市浦东新区">
        </div>
        
        <button onclick="calculateBazi()">开始计算</button>
        
        <div class="loading" id="loading">
            <p>正在计算八字，请稍候...</p>
        </div>
        
        <div class="result" id="result">
            <h2>八字计算结果</h2>
            
            <div class="result-section">
                <h3>八字命盘</h3>
                <table class="bazi-table">
                    <thead>
                        <tr>
                            <th>年柱</th>
                            <th>月柱</th>
                            <th>日柱</th>
                            <th>时柱</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="bazi-row"></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="result-section">
                <h3>五行分布</h3>
                <table class="bazi-table">
                    <thead>
                        <tr>
                            <th>金</th>
                            <th>木</th>
                            <th>水</th>
                            <th>火</th>
                            <th>土</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr id="five-elements-row"></tr>
                    </tbody>
                </table>
            </div>
            
            <div class="result-section">
                <h3>神煞</h3>
                <pre id="shen-sha"></pre>
            </div>
            
            <div class="result-section">
                <h3>起运信息</h3>
                <pre id="qi-yun"></pre>
            </div>
            
            <div class="result-section">
                <h3>大运</h3>
                <pre id="da-yun"></pre>
            </div>
            
            <div class="result-section">
                <h3>原始数据</h3>
                <pre id="raw-data"></pre>
            </div>
        </div>
    </div>
    
    <script>
        async function calculateBazi() {
            // 获取表单数据
            const gender = document.getElementById('gender').value;
            const solarYear = parseInt(document.getElementById('solarYear').value);
            const solarMonth = parseInt(document.getElementById('solarMonth').value);
            const solarDay = parseInt(document.getElementById('solarDay').value);
            const solarHour = parseInt(document.getElementById('solarHour').value);
            const birthPlace = document.getElementById('birthPlace').value;
            const livingPlace = document.getElementById('livingPlace').value;
            
            // 显示加载状态
            document.getElementById('loading').style.display = 'block';
            document.getElementById('result').style.display = 'none';
            
            // 准备请求数据
            const data = {
                solarYear,
                solarMonth,
                solarDay,
                solarHour,
                gender,
                birthPlace,
                livingPlace,
            };
            
            try {
                // 发送请求到服务器
                const response = await fetch('/api/bazi/calculate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(data)
                });
                
                // 隐藏加载状态
                document.getElementById('loading').style.display = 'none';
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                
                if (result.code !== 200) {
                    throw new Error(result.message || '计算失败');
                }
                
                // 显示结果
                displayResult(result.data);
            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                alert(`计算八字出错: ${error.message}`);
                console.error('计算八字出错:', error);
            }
        }
        
        function displayResult(data) {
            // 显示结果区域
            document.getElementById('result').style.display = 'block';
            
            // 更新八字命盘表格
            const baziRow = document.getElementById('bazi-row');
            baziRow.innerHTML = '';
            
            if (data.bazi) {
                const baziParts = data.bazi.split('，');
                baziParts.forEach(part => {
                    const td = document.createElement('td');
                    td.textContent = part;
                    baziRow.appendChild(td);
                });
            }
            
            // 更新五行分布表格
            const fiveElementsRow = document.getElementById('five-elements-row');
            fiveElementsRow.innerHTML = '';
            
            if (data.formatted_data && data.formatted_data.five_elements) {
                const elements = data.formatted_data.five_elements;
                ['metal', 'wood', 'water', 'fire', 'earth'].forEach(element => {
                    const td = document.createElement('td');
                    td.textContent = elements[element] || 0;
                    fiveElementsRow.appendChild(td);
                });
            }
            
            // 更新神煞信息
            if (data.formatted_data && data.formatted_data.shen_sha) {
                document.getElementById('shen-sha').textContent = data.formatted_data.shen_sha;
            }
            
            // 更新起运信息
            if (data.formatted_data && data.formatted_data.qi_yun) {
                document.getElementById('qi-yun').textContent = data.formatted_data.qi_yun;
            }
            
            // 更新大运信息
            if (data.formatted_data && data.formatted_data.da_yun) {
                document.getElementById('da-yun').textContent = data.formatted_data.da_yun;
            }
            
            // 显示原始数据
            document.getElementById('raw-data').textContent = JSON.stringify(data, null, 2);
        }
    </script>
</body>
</html> 
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>八字命理系统 - 神煞和大运流年测试</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        h1, h2, h3 {
            color: #333;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #45a049;
        }
        .result {
            margin-top: 20px;
            border-top: 1px solid #eee;
            padding-top: 20px;
        }
        .hidden {
            display: none;
        }
        .card {
            background-color: #f9f9f9;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .card-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
        }
        .card-content {
            padding: 5px 0;
        }
        .flex-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        .column {
            flex: 1;
            min-width: 300px;
        }
        .badge {
            display: inline-block;
            padding: 3px 8px;
            margin: 2px;
            font-size: 12px;
            border-radius: 10px;
            background-color: #e0f7fa;
            color: #00838f;
        }
        .current {
            background-color: #b3e5fc;
            border: 1px solid #29b6f6;
        }
        #loading {
            text-align: center;
            padding: 20px;
        }
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #09f;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .error {
            color: #d32f2f;
            background-color: #ffebee;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>八字命理系统 - 神煞和大运流年测试</h1>
        <p>此页面用于测试八字命理系统中神煞和大运流年的计算功能</p>
        
        <div class="form-group">
            <label for="birthDate">出生日期</label>
            <input type="date" id="birthDate" value="2008-05-22">
        </div>
        
        <div class="form-group">
            <label for="birthTime">出生时间</label>
            <input type="time" id="birthTime" value="12:00">
        </div>
        
        <div class="form-group">
            <label for="gender">性别</label>
            <select id="gender">
                <option value="male">男</option>
                <option value="female">女</option>
            </select>
        </div>
        
        <button id="calculateBtn">计算八字</button>
    </div>
    
    <div id="loading" class="hidden">
        <div class="spinner"></div>
        <p>正在计算中，请稍候...</p>
    </div>
    
    <div id="errorContainer" class="error hidden"></div>
    
    <div id="resultContainer" class="container hidden">
        <h2>计算结果</h2>
        
        <div class="flex-container">
            <div class="column">
                <div class="card">
                    <div class="card-title">八字命盘</div>
                    <div class="card-content" id="baziChart"></div>
                </div>
                
                <div class="card">
                    <div class="card-title">五行分布</div>
                    <div class="card-content" id="fiveElements"></div>
                </div>
                
                <div class="card">
                    <div class="card-title">神煞信息</div>
                    <div class="card-content" id="shenSha"></div>
                </div>
            </div>
            
            <div class="column">
                <div class="card">
                    <div class="card-title">大运信息</div>
                    <div class="card-content" id="daYun"></div>
                </div>
                
                <div class="card">
                    <div class="card-title">流年信息</div>
                    <div class="card-content" id="liuNian"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const calculateBtn = document.getElementById('calculateBtn');
            const loadingDiv = document.getElementById('loading');
            const resultContainer = document.getElementById('resultContainer');
            const errorContainer = document.getElementById('errorContainer');
            
            calculateBtn.addEventListener('click', function() {
                const birthDate = document.getElementById('birthDate').value;
                const birthTime = document.getElementById('birthTime').value;
                const gender = document.getElementById('gender').value;
                
                // 显示加载状态
                loadingDiv.classList.remove('hidden');
                resultContainer.classList.add('hidden');
                errorContainer.classList.add('hidden');
                
                // 发送API请求
                fetch('/api/bazi/calculate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        birthDate: birthDate,
                        birthTime: birthTime,
                        gender: gender
                    })
                })
                .then(response => response.json())
                .then(data => {
                    // 隐藏加载状态
                    loadingDiv.classList.add('hidden');
                    
                    if (data.code === 200) {
                        // 显示结果
                        resultContainer.classList.remove('hidden');
                        displayResults(data.data);
                    } else {
                        // 显示错误
                        errorContainer.textContent = data.message || '计算八字时发生错误';
                        errorContainer.classList.remove('hidden');
                    }
                })
                .catch(error => {
                    // 隐藏加载状态，显示错误
                    loadingDiv.classList.add('hidden');
                    errorContainer.textContent = '请求失败: ' + error.message;
                    errorContainer.classList.remove('hidden');
                });
            });
            
            function displayResults(data) {
                // 显示八字命盘
                const baziChartDiv = document.getElementById('baziChart');
                baziChartDiv.innerHTML = `
                    <p>年柱: ${data.yearPillar.heavenlyStem}${data.yearPillar.earthlyBranch} (${data.yearPillar.naYin})</p>
                    <p>月柱: ${data.monthPillar.heavenlyStem}${data.monthPillar.earthlyBranch} (${data.monthPillar.naYin})</p>
                    <p>日柱: ${data.dayPillar.heavenlyStem}${data.dayPillar.earthlyBranch} (${data.dayPillar.naYin})</p>
                    <p>时柱: ${data.hourPillar.heavenlyStem}${data.hourPillar.earthlyBranch} (${data.hourPillar.naYin})</p>
                    <p>生肖: ${data.shengXiao}</p>
                `;
                
                // 显示五行分布
                const fiveElementsDiv = document.getElementById('fiveElements');
                fiveElementsDiv.innerHTML = `
                    <p>金: ${data.fiveElements.metal}</p>
                    <p>木: ${data.fiveElements.wood}</p>
                    <p>水: ${data.fiveElements.water}</p>
                    <p>火: ${data.fiveElements.fire}</p>
                    <p>土: ${data.fiveElements.earth}</p>
                `;
                
                // 显示神煞信息
                const shenShaDiv = document.getElementById('shenSha');
                if (data.shenSha) {
                    let shenShaHtml = `
                        <p>日冲: ${data.shenSha.dayChong || '无'}</p>
                        <p>值神: ${data.shenSha.zhiShen || '无'}</p>
                        <p>彭祖百忌: ${data.shenSha.pengZuGan || '无'}, ${data.shenSha.pengZuZhi || '无'}</p>
                        <p>喜神方位: ${data.shenSha.xiShen || '无'}</p>
                        <p>福神方位: ${data.shenSha.fuShen || '无'}</p>
                        <p>财神方位: ${data.shenSha.caiShen || '无'}</p>
                    `;
                    
                    // 本命神煞
                    shenShaHtml += '<p>本命神煞: ';
                    if (data.shenSha.benMing && data.shenSha.benMing.length > 0) {
                        data.shenSha.benMing.forEach(item => {
                            shenShaHtml += `<span class="badge">${item}</span>`;
                        });
                    } else {
                        shenShaHtml += '无';
                    }
                    shenShaHtml += '</p>';
                    
                    // 年干神煞
                    shenShaHtml += '<p>年干神煞: ';
                    if (data.shenSha.yearGan && data.shenSha.yearGan.length > 0) {
                        data.shenSha.yearGan.forEach(item => {
                            shenShaHtml += `<span class="badge">${item}</span>`;
                        });
                    } else {
                        shenShaHtml += '无';
                    }
                    shenShaHtml += '</p>';
                    
                    // 年支神煞
                    shenShaHtml += '<p>年支神煞: ';
                    if (data.shenSha.yearZhi && data.shenSha.yearZhi.length > 0) {
                        data.shenSha.yearZhi.forEach(item => {
                            shenShaHtml += `<span class="badge">${item}</span>`;
                        });
                    } else {
                        shenShaHtml += '无';
                    }
                    shenShaHtml += '</p>';
                    
                    // 日干神煞
                    shenShaHtml += '<p>日干神煞: ';
                    if (data.shenSha.dayGan && data.shenSha.dayGan.length > 0) {
                        data.shenSha.dayGan.forEach(item => {
                            shenShaHtml += `<span class="badge">${item}</span>`;
                        });
                    } else {
                        shenShaHtml += '无';
                    }
                    shenShaHtml += '</p>';
                    
                    // 日支神煞
                    shenShaHtml += '<p>日支神煞: ';
                    if (data.shenSha.dayZhi && data.shenSha.dayZhi.length > 0) {
                        data.shenSha.dayZhi.forEach(item => {
                            shenShaHtml += `<span class="badge">${item}</span>`;
                        });
                    } else {
                        shenShaHtml += '无';
                    }
                    shenShaHtml += '</p>';
                    
                    shenShaDiv.innerHTML = shenShaHtml;
                } else {
                    shenShaDiv.innerHTML = '<p>无神煞信息</p>';
                }
                
                // 显示大运信息
                const daYunDiv = document.getElementById('daYun');
                if (data.daYun && typeof data.daYun === 'object') {
                    let daYunHtml = `
                        <p>起运年龄: ${data.daYun.startAge || '未知'}岁</p>
                        <p>起运年份: ${data.daYun.startYear || '未知'}年</p>
                        <p>大运列表:</p>
                    `;
                    
                    if (data.daYun.daYun && data.daYun.daYun.length > 0) {
                        data.daYun.daYun.forEach(item => {
                            let currentClass = item.isCurrent ? 'current' : '';
                            daYunHtml += `
                                <div class="card ${currentClass}">
                                    <div class="card-title">第${item.index}运 (${item.startAge}-${item.endAge}岁, ${item.startYear}-${item.endYear}年)</div>
                                    <div class="card-content">
                                        <p>干支: ${item.ganZhi}</p>
                                        <p>五行: ${item.gan}(${item.ganWuxing}), ${item.zhi}(${item.zhiWuxing})</p>
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        daYunHtml += '<p>无大运信息</p>';
                    }
                    
                    daYunDiv.innerHTML = daYunHtml;
                } else {
                    daYunDiv.innerHTML = '<p>无大运信息</p>';
                }
                
                // 显示流年信息
                const liuNianDiv = document.getElementById('liuNian');
                let liuNianHtml = '<p>当前及未来流年:</p>';
                let liuNianFound = false;
                
                // 查找当前大运的流年
                if (data.daYun && data.daYun.daYun) {
                    data.daYun.daYun.forEach(daYunItem => {
                        if (daYunItem.isCurrent && daYunItem.liuNian && daYunItem.liuNian.length > 0) {
                            liuNianFound = true;
                            
                            daYunItem.liuNian.forEach(liuNian => {
                                let currentClass = liuNian.isCurrent ? 'current' : '';
                                liuNianHtml += `
                                    <div class="card ${currentClass}">
                                        <div class="card-title">${liuNian.year}年 (${liuNian.age}岁)</div>
                                        <div class="card-content">
                                            <p>干支: ${liuNian.ganZhi} (${liuNian.shengXiao})</p>
                                            <p>五行: ${liuNian.gan}(${liuNian.ganWuxing}), ${liuNian.zhi}(${liuNian.zhiWuxing})</p>
                                            <p>关系: 天干-${liuNian.relations.ganRelation}, 地支-${liuNian.relations.zhiRelation}</p>
                                            <p>神煞: `;
                                
                                if (liuNian.shenSha && liuNian.shenSha.length > 0) {
                                    liuNian.shenSha.forEach(item => {
                                        liuNianHtml += `<span class="badge">${item}</span>`;
                                    });
                                } else {
                                    liuNianHtml += '无';
                                }
                                
                                liuNianHtml += `</p>
                                            <p>岁运: ${liuNian.suiYun.taiSui}, ${liuNian.suiYun.taiYin}, ${liuNian.suiYun.taiYang}</p>
                                        </div>
                                    </div>
                                `;
                            });
                        }
                    });
                }
                
                if (!liuNianFound) {
                    liuNianHtml += '<p>无流年信息</p>';
                }
                
                liuNianDiv.innerHTML = liuNianHtml;
            }
        });
    </script>
</body>
</html> 